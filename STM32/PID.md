# 概述
PID控制器（比例-积分-微分控制器），由比例单元(P)、积分单元(I)和微分单元(D)组成。透过
Kp，Ki和Kd三个参数的设定。PID控制器主要适用于基本上线性，且动态特性不随时间变化的系统。
![PID](https://upload.wikimedia.org/wikipedia/commons/4/40/Pid-feedback-nct-int-correct.png)

# 数学原理
![PID控制输出](https://wikimedia.org/api/rest_v1/media/math/render/svg/6d0715de877e00cd15a9231f9182c17d9869ed1c)
$$
u(t)=MV(t)=K_{p}e(t)+K_{i}\int e(\tau)  
$$

其中
  + $K_{p}$：比例增益，是调适参数。
    若比例增益大，在相同误差量下，会有较大的输出，但若比例增益太大，会使系统不稳定。相
    反的，若比例增益小，若在相同误差量下，其输出较小，因此控制器会较不敏感的。若比例增
    益太小，当有干扰出现时，其控制信号可能不够大，无法修正干扰的影响。
  + $K_{i}$：积分增益，也是调适参数。
    积分控制考虑过去误差，将误差值过去一段时间和（误差和）乘以一个正值的常数Ki。Ki从过
    去的平均误差值来找到系统的输出结果和预定值的平均误差。一个简单的比例系统会震荡，会
    在预定值的附近来回变化，因为系统无法消除多余的纠正。通过加上负的平均误差值，平均系
    统误差值就会渐渐减少。所以，最终这个PID回路系统会在设定值稳定下来。积分控制会加速
    系统趋近设定值的过程，并且消除纯比例控制器会出现的稳态误差。积分增益越大，趋近设定
    值的速度越快，不过因为积分控制会累计过去所有的误差，可能会使回授值出现过冲的情形。
  + $K_{d}$：微分增益，也是调适参数。
    微分控制考虑将来误差，计算误差的一阶导，并和一个正值的常数Kd相乘。这个导数的控制会
    对系统的改变作出反应。导数的结果越大，那么控制系统就对输出结果作出更快速的反应。这
    个Kd参数也是PID被称为可预测的控制器的原因。Kd参数对减少控制器短期的改变很有帮助。
    一些实际中的速度缓慢的系统可以不需要Kd参数。微分控制可以提升整定时间及系统稳定性。
    实际上较少用到微分控制，估计PID控制器中只有约20%有用到微分控制。
  + $e$：误差=设定值（SP）- 回授值（PV）
  + $t$：目前时间
  + $\tau$ ：积分变数，数值从0到目前时间 $t$
  + 稳态误差。例如云台Pitch轴受重力的影响。


用更专业的话来讲，PID控制器可以视为是频域系统的滤波器。在计算控制器最终是否会达到稳定结
果时，此性质很有用。如果数值挑选不当，控制系统的输入值会反复振荡，这导致系统可能永远无法
达到预设值。

# 调参
+ **人工调参**：
  若需在系统仍有负载的情形进行调试（线上调试），有一种作法是先将 {\displaystyle K_{i}}
   K_{i}及 {\displaystyle K_{d}} K_{d}设为零，增加 {\displaystyle K_{p}} K_{p}一直
   到回路输出震荡为止，之后再将 {\displaystyle K_{p}} K_{p}设定为“1/4振幅衰减”（使系
   统第二次过冲量是第一次的1/4）增益的一半，然后增加 {\displaystyle K_{i}} K_{i}直到
   一定时间后的稳态误差可被修正为止。不过若 {\displaystyle K_{i}} K_{i}可能会造成不稳
   定，最后若有需要，可以增加 {\displaystyle K_{d}} K_{d}，并确认在负载变动后回路可以
   够快的回到其设定值，不过若 {\displaystyle K_{d}} K_{d}太大会造成响应太快及过冲。
   一般而言快速反应的PID应该会有轻微的过冲，只是有些系统不允许过冲。因此需要将回授系统
   调整为过阻尼系统，而 {\displaystyle K_{p}} K_{p}比造成震荡 {\displaystyle K_{p}}
   K_{p}的一半还要小很多。
![人工调参](https://upload.wikimedia.org/wikipedia/commons/3/33/PID_Compensation_A
nimated.gif)


# 更多
**前馈控制**:
PID控制器若再配合前馈控制（开回路控制），可以再提升其控制性能。在前馈控制中考虑系统的已
知信息（例如理想加速度或是惯量），再将输出加到PID控制器的控制输出，以提升整体的系统性能。
前馈量可能是控制输出主要的部分，而PID控制器只用来补偿目标值和开回路控制器输出之间的误差。
因为前馈输出不会受到回授的影响，因此也不会造成系统的振荡，可以在不影响稳定性的条件下提升
系统的响应。前馈可以依目标值及其他量测到的干扰量来产生，目标值加权是一种简单的前馈控制方
式。例如，在大部分的运动控制系统中，为了要使机械负载加速，致动器要产生更大的力。若用速度
环的PID控制器来控制负载速度，比较理想的方式是先得到理想的瞬间加速度值，适量调整加权后再
加到PID的输出中。因此控制器输出中有一部分是不随机械速度而改变的输出，再用PID根据实际输
出和目标的差异去增加或是减少输出。这类有前馈控制的PID控制器可以加快控制系统的反应速度。

# 参考
+ [PID控制器](https://zh.wikipedia.org/wiki/PID%E6%8E%A7%E5%88%B6%E5%99%A8)
+ http://bbs.elecfans.com/jishu_484125_1_1.html
